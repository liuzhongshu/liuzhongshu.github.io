---
published: true
title: Android开发环境
layout: post
---
## Android Studio

从[这里](http://www.androiddevtools.cn/)下载Android Studio，下载最大最新的那个，含sdk和各种tools，省得后续下载的痛苦。

安装的时候，可以选择安装路径，如果不按缺省路径，安装完成后记得设置环境变量ANDROID_HOME到sdk的目录。因为后续很多步骤是依赖这个变量来找sdk。

sdk的目录下有个SDK Manager.exe，这个可以用来继续安装更多的sdk，默认的话，一般只带一个比较新的sdk，可以多安装几个sdk，也可以等到需要再装。

## 国情设置

在启动Android Studio之前，针对我们国情，建议增加`c:\users\xxx\.gradle\init.gradle`文件，内容如下：

```
allprojects {
    repositories {
        maven{ url 'http://maven.aliyun.com/nexus/content/groups/public'}
    }
}
```

这个为gradle设置一个镜像，可以防止gradle从中央库下载文件（非常慢）。

## 运行studio

第一次运行，会有的一个向导，可以取消掉，没有关系。但是接下来，一定不要open之前的项目，因为项目需要的gradle版本不一致，一样可能会卡死，所以保险的方式是先创建一个HelloWorld，成功之后把其下gradle\wrapper\gradle-wrapper.proerties文件的最后一行拷贝出来，以后所有的项目都用这一行，类似下面这个：

```
distributionUrl=https\://services.gradle.org/distributions/gradle-2.14.1-all.zip
```

也就是说，所有的项目都要修改这个proerties文件，确保用同一个gradle版本，以免去下载，理论上这样可能有些问题（万一gradle不兼容），所以另一个解决下载gradle卡死的方法是先让他卡，然后杀掉Android Studio，再去 [这里](http://services.gradle.org/distributions/) 下载对应的版本，然后放到

```
C:\Users\用户名\.gradle\wrapper\dists\gradle-xxx-all\sdfdfa4w5fzrksdfaweeut
```

后面这串乱码是Android Studio在打开工程时自动建出来的，所以要让他先卡一下，把这个目录建出来（有点奇葩的设计），然后就可以放进去了。


## 模拟器

在Android Studio内可以管理模拟器，一定记得使能Intel Haxm，可以大大加速模拟器的速度，使能Intel Haxm会自动从intel下载一个驱动并自动安装，但是要在下次重启计算机之后，Haxm才会起到加速效果，所以如果安装了Haxm，还是很慢的话，可能需要重启下。

## 真机调试

真机调试需要在手机上开USB调试选项，然后用USB接到开发机上，安装驱动，就可以调试了，如果和我一样不喜欢安装驱动的话，可以使用无线调试，需要手机和开发机在同一局域网内，在Android Studio的命令行下输入

```
adb connect 192.168.xx.xx
```

如果找不到adb，先进入sdk下的platfrom-tools这个目录再执行。这样手机上会弹出提示，确认之后，就可以通过wifi调试真机了。

运行的时候如果出This version of android studio is incompatible with the gradle version used.Try disabling the instant run，可以在 Settings/Preferences > Build, Execution, Deployment option > Instant Run 下面禁用Instance run所有选项即可。

## Cordova/Ionic

如果使用Cordova或者Ionic创建工程，先安装node，安装之后设置一下npm，在用户目录下创建.npmrc，增加下面的一行，以加快npm的速度。

```
registry =http://registry.npm.taobao.org
```

再安装和创建cordova/ionic工程就会快些了

```
npm install ionic cordova -g
ionic start demo tabs --verbose
```

start项目这个过程中，会多次下载一些依赖，国情决定了可能会失败，也可能会成功，取决与运气（所以我加了--verbose可以看的更清楚一些）。如果成功，就可以下一步了：

```
cordova platform add android
```

之后，可以尝试`cordova build android`，但是又可能卡死，因为又去下载东西了，参考上面的修改gradle-wrapper.proerties，重新用Android Studio应该可以打开这个工程了，打开的时候选择项目下的platform\android这个目录即可。

## cordova 插件
可以为cordova项目安装插件

```
cordova plugin add https://github.com/don/cordova-plugin-hello.git
```

这样的话，plugins目录下就会多出通过git下载的插件了，后面build的话，插件会自动生效，如果增加比较多的插件，而这些插件又不上版本库的话，需要在config.xml里把插件记录下来，所以上面的命令可以加--save自动记录，或者可以使用

```
cordova plugin save
```

一次性统一记录到config.xml，下次从版本库checkout出来之后，需要用

```
cordova prepare
```

来重新下载这些插件。
